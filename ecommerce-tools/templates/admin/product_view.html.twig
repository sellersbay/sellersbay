{% extends 'base.html.twig' %}

{% block title %}Product Details - Admin - RoboSEO{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        .admin-nav .nav-link {
            color: #4e73df;
            padding: 1rem;
            border-radius: 0.35rem;
            margin-bottom: 0.5rem;
            transition: all 0.2s;
        }
        
        .admin-nav .nav-link:hover {
            background-color: #eaecf4;
        }
        
        .admin-nav .nav-link.active {
            background-color: #4e73df;
            color: white;
        }
        
        .admin-nav .nav-link i {
            margin-right: 0.5rem;
        }
        
        .product-header {
            background-color: #f8f9fc;
            border-radius: 0.5rem;
            padding: 2rem;
        }
        
        .product-image {
            width: 150px;
            height: 150px;
            border-radius: 0.5rem;
            object-fit: cover;
            background-color: #f1f1f1;
            color: #a1a1a1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
        }
        
        .product-info label {
            font-weight: 600;
            color: #4e73df;
            font-size: 0.8rem;
        }
        
        .product-stats-card {
            border-left: 4px solid #4e73df;
            transition: transform 0.2s;
        }
        
        .product-stats-card:hover {
            transform: translateY(-5px);
        }
        
        .product-stats-card.status { border-left-color: #1cc88a; }
        .product-stats-card.woo { border-left-color: #f6c23e; }
        .product-stats-card.content { border-left-color: #36b9cc; }
        
        .tab-content {
            padding: 1.5rem;
            border: 1px solid #e3e6f0;
            border-top: none;
            border-radius: 0 0 0.35rem 0.35rem;
        }
        
        .nav-tabs .nav-link {
            color: #5a5c69;
            font-weight: 600;
        }
        
        .nav-tabs .nav-link.active {
            color: #4e73df;
            font-weight: 700;
        }
        
        .content-editor {
            border: 1px solid #e3e6f0;
            border-radius: 0.35rem;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .content-editor h6 {
            margin-bottom: 0.5rem;
            color: #4e73df;
            font-weight: 700;
        }
        
        .content-editor .content-preview {
            background-color: #f8f9fc;
            padding: 1rem;
            border-radius: 0.35rem;
            margin-bottom: 1rem;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .ai-badge {
            background-color: #4e73df;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.35rem;
            font-size: 0.75rem;
            margin-left: 0.5rem;
        }
        
        .original-badge {
            background-color: #858796;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.35rem;
            font-size: 0.75rem;
            margin-left: 0.5rem;
        }
    </style>
{% endblock %}

{% block body %}
<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{{ path('app_admin_dashboard') }}">Dashboard</a></li>
                    <li class="breadcrumb-item"><a href="{{ path('app_admin_products') }}">Products</a></li>
                    <li class="breadcrumb-item active" aria-current="page">Product Details</li>
                </ol>
            </nav>
            <h1 class="h3 mb-0 text-gray-800">Product Details</h1>
        </div>
    </div>

    <div class="row">
        <!-- Admin Navigation Sidebar -->
        <div class="col-xl-3 col-lg-4 mb-4">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Admin Navigation</h6>
                </div>
                <div class="card-body">
                    <div class="admin-nav">
                        <a href="{{ path('app_admin_dashboard') }}" class="nav-link">
                            <i class="fas fa-tachometer-alt"></i> Dashboard
                        </a>
                        <a href="{{ path('app_admin_users') }}" class="nav-link">
                            <i class="fas fa-users"></i> User Management
                        </a>
                        <a href="{{ path('app_admin_products') }}" class="nav-link active">
                            <i class="fas fa-box"></i> Product Management
                        </a>
                        <a href="{{ path('app_admin_credits') }}" class="nav-link">
                            <i class="fas fa-coins"></i> Credits Management
                        </a>
                        <a href="{{ path('app_admin_subscriptions') }}" class="nav-link">
                            <i class="fas fa-receipt"></i> Subscription Plans
                        </a>
                        <a href="{{ path('app_admin_statistics') }}" class="nav-link">
                            <i class="fas fa-chart-bar"></i> System Statistics
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="card shadow">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Product Actions</h6>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#generateAIModal">
                            <i class="fas fa-robot"></i> Generate AI Content
                        </button>
                        <button type="button" class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#exportProductModal">
                            <i class="fas fa-file-export"></i> Export to WooCommerce
                        </button>
                        <a href="{{ path('app_admin_products') }}" class="btn btn-secondary btn-sm">
                            <i class="fas fa-arrow-left"></i> Back to Products
                        </a>
                        <button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteProductModal">
                            <i class="fas fa-trash"></i> Delete Product
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Main Content Area -->
        <div class="col-xl-9 col-lg-8">
            <!-- Product Header -->
            <div class="card shadow mb-4">
                <div class="card-body p-0">
                    <div class="product-header">
                        <div class="row align-items-center">
                            <div class="col-lg-2 text-center mb-3 mb-lg-0">
                                {% if product.imageUrl %}
                                    <img src="{{ product.imageUrl }}" alt="{{ product.name }}" class="product-image mx-auto">
                                {% else %}
                                    <div class="product-image mx-auto">
                                        <i class="fas fa-box"></i>
                                    </div>
                                {% endif %}
                            </div>
                            <div class="col-lg-7 product-info">
                                <h2 class="h4 font-weight-bold mb-2">{{ product.name }}</h2>
                                <div class="mb-3">
                                    <span class="text-muted">WooCommerce ID: #{{ product.woocommerceId }}</span>
                                </div>
                                <div class="mb-3">
                                    {% if product.status == 'imported' %}
                                        <span class="badge bg-secondary">Imported</span>
                                    {% elseif product.status == 'ai_processed' %}
                                        <span class="badge bg-primary">AI Processed</span>
                                    {% elseif product.status == 'exported' %}
                                        <span class="badge bg-success">Exported</span>
                                    {% else %}
                                        <span class="badge bg-light text-dark">{{ product.status|capitalize }}</span>
                                    {% endif %}
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-2">
                                        <label>Product ID</label>
                                        <p>{{ product.id }}</p>
                                    </div>
                                    <div class="col-md-6 mb-2">
                                        <label>Owner</label>
                                        <p>
                                            <a href="{{ path('app_admin_user_view', {'id': product.owner.id}) }}">
                                                {{ product.owner.firstName }} {{ product.owner.lastName }}
                                            </a>
                                        </p>
                                    </div>
                                    <div class="col-md-6 mb-2">
                                        <label>Imported</label>
                                        <p>{{ product.createdAt|date('Y-m-d H:i') }}</p>
                                    </div>
                                    <div class="col-md-6 mb-2">
                                        <label>Last Updated</label>
                                        <p>{{ product.updatedAt|date('Y-m-d H:i') }}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-3 text-center">
                                <div class="d-grid gap-2">
                                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#generateAIModal">
                                        <i class="fas fa-robot"></i> Generate AI Content
                                    </button>
                                    {% if product.status == 'ai_processed' or product.status == 'exported' %}
                                        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#exportProductModal">
                                            <i class="fas fa-file-export"></i> Export
                                        </button>
                                    {% else %}
                                        <button class="btn btn-success" disabled title="Generate AI content first">
                                            <i class="fas fa-file-export"></i> Export
                                        </button>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Product Stats -->
            <div class="row mb-4">
                <!-- Status Card -->
                <div class="col-xl-4 col-md-6 mb-4">
                    <div class="card h-100 shadow product-stats-card status">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Status</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800">{{ product.status|capitalize }}</div>
                                </div>
                                <div class="col-auto">
                                    {% if product.status == 'imported' %}
                                        <i class="fas fa-file-import fa-2x text-gray-300"></i>
                                    {% elseif product.status == 'ai_processed' %}
                                        <i class="fas fa-robot fa-2x text-gray-300"></i>
                                    {% elseif product.status == 'exported' %}
                                        <i class="fas fa-file-export fa-2x text-gray-300"></i>
                                    {% else %}
                                        <i class="fas fa-question-circle fa-2x text-gray-300"></i>
                                    {% endif %}
                                </div>
                            </div>
                            {% if product.status == 'exported' %}
                                <div class="text-xs text-muted mt-2">Last exported: {{ product.updatedAt|date('Y-m-d') }}</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- WooCommerce Card -->
                <div class="col-xl-4 col-md-6 mb-4">
                    <div class="card h-100 shadow product-stats-card woo">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">WooCommerce</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800">ID: {{ product.woocommerceId }}</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fab fa-wordpress fa-2x text-gray-300"></i>
                                </div>
                            </div>
                            <div class="text-xs text-muted mt-2">
                                Store: {{ product.storeUrl|default('Not specified')|replace({'https://': '', 'http://': ''}) }}
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Content Stats Card -->
                <div class="col-xl-4 col-md-6 mb-4">
                    <div class="card h-100 shadow product-stats-card content">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-info text-uppercase mb-1">AI Content</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800">
                                        {% if product.aiGeneratedContent|default(false) %}
                                            Generated
                                        {% else %}
                                            Not Generated
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-file-alt fa-2x text-gray-300"></i>
                                </div>
                            </div>
                            <div class="mt-2">
                                {% if product.aiGeneratedContent|default(false) %}
                                    <div class="text-xs text-muted">Content is optimized for SEO</div>
                                {% else %}
                                    <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#generateAIModal">
                                        <i class="fas fa-robot"></i> Generate
                                    </button>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Product Tabs -->
            <div class="card shadow mb-4">
                <div class="card-header p-0">
                    <ul class="nav nav-tabs" id="productDetailsTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="content-tab" data-bs-toggle="tab" data-bs-target="#content" 
                                    type="button" role="tab" aria-controls="content" aria-selected="true">
                                <i class="fas fa-file-alt me-1"></i> Content
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="seo-tab" data-bs-toggle="tab" data-bs-target="#seo" 
                                    type="button" role="tab" aria-controls="seo" aria-selected="false">
                                <i class="fas fa-search me-1"></i> SEO
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="details-tab" data-bs-toggle="tab" data-bs-target="#details" 
                                    type="button" role="tab" aria-controls="details" aria-selected="false">
                                <i class="fas fa-info-circle me-1"></i> Details
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="history-tab" data-bs-toggle="tab" data-bs-target="#history" 
                                    type="button" role="tab" aria-controls="history" aria-selected="false">
                                <i class="fas fa-history me-1"></i> History
                            </button>
                        </li>
                    </ul>
                </div>
                <div class="card-body">
                    <div class="tab-content" id="productDetailsTabsContent">
                        <!-- Content Tab -->
                        <div class="tab-pane fade show active" id="content" role="tabpanel" aria-labelledby="content-tab">
                            <!-- Product Description -->
                            <div class="content-editor">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h6>Full Description <span class="ai-badge">AI Generated</span></h6>
                                    <div>
                                        <button class="btn btn-sm btn-outline-primary edit-content-btn" 
                                                data-content-type="description">
                                            <i class="fas fa-edit"></i> Edit
                                        </button>
                                    </div>
                                </div>
                                <div class="content-preview" id="descriptionPreview">
                                    {% if product.description|default(false) %}
                                        {{ product.description|raw }}
                                    {% else %}
                                        <p class="text-muted">No description available.</p>
                                    {% endif %}
                                </div>
                                <div id="descriptionEditor" class="d-none">
                                    <textarea class="form-control mb-2" rows="8">{% if product.description|default(false) %}{{ product.description }}{% endif %}</textarea>
                                    <div class="d-flex justify-content-end">
                                        <button class="btn btn-sm btn-secondary me-2 cancel-edit-btn" 
                                                data-content-type="description">Cancel</button>
                                        <button class="btn btn-sm btn-primary save-content-btn" 
                                                data-content-type="description">Save Changes</button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Short Description -->
                            <div class="content-editor">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h6>Short Description <span class="ai-badge">AI Generated</span></h6>
                                    <div>
                                        <button class="btn btn-sm btn-outline-primary edit-content-btn" 
                                                data-content-type="shortDescription">
                                            <i class="fas fa-edit"></i> Edit
                                        </button>
                                    </div>
                                </div>
                                <div class="content-preview" id="shortDescriptionPreview">
                                    {% if product.shortDescription|default(false) %}
                                        {{ product.shortDescription|raw }}
                                    {% else %}
                                        <p class="text-muted">No short description available.</p>
                                    {% endif %}
                                </div>
                                <div id="shortDescriptionEditor" class="d-none">
                                    <textarea class="form-control mb-2" rows="3">{% if product.shortDescription|default(false) %}{{ product.shortDescription }}{% endif %}</textarea>
                                    <div class="d-flex justify-content-end">
                                        <button class="btn btn-sm btn-secondary me-2 cancel-edit-btn" 
                                                data-content-type="shortDescription">Cancel</button>
                                        <button class="btn btn-sm btn-primary save-content-btn" 
                                                data-content-type="shortDescription">Save Changes</button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Original Description -->
                            <div class="content-editor">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h6>Original Description <span class="original-badge">WooCommerce Import</span></h6>
                                    <div>
                                        <button class="btn btn-sm btn-outline-secondary restore-original-btn" 
                                                data-content-type="description">
                                            <i class="fas fa-undo"></i> Restore Original
                                        </button>
                                    </div>
                                </div>
                                <div class="content-preview">
                                    {% if product.originalData.description|default(false) %}
                                        {{ product.originalData.description|raw }}
                                    {% else %}
                                        <p class="text-muted">No original description available.</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <!-- SEO Tab -->
                        <div class="tab-pane fade" id="seo" role="tabpanel" aria-labelledby="seo-tab">
                            <!-- Meta Description -->
                            <div class="content-editor">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h6>Meta Description <span class="ai-badge">AI Generated</span></h6>
                                    <div>
                                        <button class="btn btn-sm btn-outline-primary edit-content-btn" 
                                                data-content-type="metaDescription">
                                            <i class="fas fa-edit"></i> Edit
                                        </button>
                                    </div>
                                </div>
                                <div class="content-preview" id="metaDescriptionPreview">
                                    {% if product.metaDescription|default(false) %}
                                        {{ product.metaDescription }}
                                    {% else %}
                                        <p class="text-muted">No meta description available.</p>
                                    {% endif %}
                                </div>
                                <div id="metaDescriptionEditor" class="d-none">
                                    <textarea class="form-control mb-2" rows="2">{% if product.metaDescription|default(false) %}{{ product.metaDescription }}{% endif %}</textarea>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <small class="text-muted character-count">0/155 characters</small>
                                        </div>
                                        <div>
                                            <button class="btn btn-sm btn-secondary me-2 cancel-edit-btn" 
                                                    data-content-type="metaDescription">Cancel</button>
                                            <button class="btn btn-sm btn-primary save-content-btn" 
                                                    data-content-type="metaDescription">Save Changes</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Image Alt Text -->
                            <div class="content-editor">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h6>Image Alt Text <span class="ai-badge">AI Generated</span></h6>
                                    <div>
                                        <button class="btn btn-sm btn-outline-primary edit-content-btn" 
                                                data-content-type="imageAltText">
                                            <i class="fas fa-edit"></i> Edit
                                        </button>
                                    </div>
                                </div>
                                <div class="content-preview" id="imageAltTextPreview">
                                    {% if product.imageAltText|default(false) %}
                                        {{ product.imageAltText }}
                                    {% else %}
                                        <p class="text-muted">No image alt text available.</p>
                                    {% endif %}
                                </div>
                                <div id="imageAltTextEditor" class="d-none">
                                    <textarea class="form-control mb-2" rows="1">{% if product.imageAltText|default(false) %}{{ product.imageAltText }}{% endif %}</textarea>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <small class="text-muted character-count">0/125 characters</small>
                                        </div>
                                        <div>
                                            <button class="btn btn-sm btn-secondary me-2 cancel-edit-btn" 
                                                    data-content-type="imageAltText">Cancel</button>
                                            <button class="btn btn-sm btn-primary save-content-btn" 
                                                    data-content-type="imageAltText">Save Changes</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- SEO Keywords (Premium) -->
                            <div class="content-editor">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h6>SEO Keywords <span class="ai-badge">Premium</span></h6>
                                    <div>
                                        <button class="btn btn-sm btn-outline-primary edit-content-btn" 
                                                data-content-type="seoKeywords">
                                            <i class="fas fa-edit"></i> Edit
                                        </button>
                                    </div>
                                </div>
                                <div class="content-preview" id="seoKeywordsPreview">
                                    {% if product.aiGeneratedContent.seoKeywords|default(false) %}
                                        {{ product.aiGeneratedContent.seoKeywords|raw }}
                                    {% else %}
                                        <p class="text-muted">No SEO keywords available. Generate premium AI content to access this feature.</p>
                                    {% endif %}
                                </div>
                                <div id="seoKeywordsEditor" class="d-none">
                                    <textarea class="form-control mb-2" rows="8">{% if product.aiGeneratedContent.seoKeywords|default(false) %}{{ product.aiGeneratedContent.seoKeywords }}{% endif %}</textarea>
                                    <div class="d-flex justify-content-end">
                                        <button class="btn btn-sm btn-secondary me-2 cancel-edit-btn" 
                                                data-content-type="seoKeywords">Cancel</button>
                                        <button class="btn btn-sm btn-primary save-content-btn" 
                                                data-content-type="seoKeywords">Save Changes</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Details Tab -->
                        <div class="tab-pane fade" id="details" role="tabpanel" aria-labelledby="details-tab">
                            <h5 class="mb-4">Product Information</h5>
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">WooCommerce ID</label>
                                        <input type="text" class="form-control" value="{{ product.woocommerceId }}" readonly>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Store URL</label>
                                        <input type="text" class="form-control" value="{{ product.storeUrl }}" readonly>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Import Date</label>
                                        <input type="text" class="form-control" value="{{ product.createdAt|date('Y-m-d H:i') }}" readonly>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold">Last Updated</label>
                                        <input type="text" class="form-control" value="{{ product.updatedAt|date('Y-m-d H:i') }}" readonly>
                                    </div>
                                </div>
                            </div>
                            
                            <h5 class="mb-4">Original WooCommerce Data</h5>
                            <div class="card">
                                <div class="card-body">
                                    {% if product.originalData|default(false) %}
                                        <div class="table-responsive">
                                            <table class="table table-bordered">
                                                <tbody>
                                                    {% for key, value in product.originalData %}
                                                        {% if key not in ['description', 'short_description'] and value is not iterable %}
                                                            <tr>
                                                                <td width="200">{{ key|replace({'_': ' '})|capitalize }}</td>
                                                                <td>{{ value }}</td>
                                                            </tr>
                                                        {% endif %}
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                        
                                        <div class="mt-3">
                                            <button class="btn btn-sm btn-outline-primary" type="button" data-bs-toggle="collapse" data-bs-target="#rawDataCollapse">
                                                <i class="fas fa-code"></i> View Raw JSON Data
                                            </button>
                                            <div class="collapse mt-3" id="rawDataCollapse">
                                                <div class="card card-body">
                                                    <pre class="text-muted">{{ product.originalData|json_encode(constant('JSON_PRETTY_PRINT')) }}</pre>
                                                </div>
                                            </div>
                                        </div>
                                    {% else %}
                                        <div class="alert alert-info">
                                            <i class="fas fa-info-circle me-2"></i>
                                            No original data available.
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <!-- History Tab -->
                        <div class="tab-pane fade" id="history" role="tabpanel" aria-labelledby="history-tab">
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>
                                History tracking is still in development. This feature will be available soon.
                            </div>
                            
                            <!-- Placeholder timeline for future implementation -->
                            <div class="activity-timeline">
                                <div class="timeline-item d-flex mb-3">
                                    <div class="timeline-item-marker me-3">
                                        <div class="timeline-item-marker-indicator bg-success d-flex align-items-center justify-content-center" style="width: 40px; height: 40px; border-radius: 50%;">
                                            <i class="fas fa-file-export text-white"></i>
                                        </div>
                                    </div>
                                    <div class="timeline-item-content p-3 bg-light rounded">
                                        <p class="fw-bold mb-1">Exported to WooCommerce</p>
                                        <p class="mb-0 text-muted">Content successfully exported to WooCommerce store</p>
                                        <p class="text-xs text-muted">Today at 12:45 PM</p>
                                    </div>
                                </div>
                                
                                <div class="timeline-item d-flex mb-3">
                                    <div class="timeline-item-marker me-3">
                                        <div class="timeline-item-marker-indicator bg-primary d-flex align-items-center justify-content-center" style="width: 40px; height: 40px; border-radius: 50%;">
                                            <i class="fas fa-robot text-white"></i>
                                        </div>
                                    </div>
                                    <div class="timeline-item-content p-3 bg-light rounded">
                                        <p class="fw-bold mb-1">AI Content Generated</p>
                                        <p class="mb-0 text-muted">Generated descriptions, meta data, and SEO content</p>
                                        <p class="text-xs text-muted">Yesterday at 3:30 PM</p>
                                    </div>
                                </div>
                                
                                <div class="timeline-item d-flex mb-3">
                                    <div class="timeline-item-marker me-3">
                                        <div class="timeline-item-marker-indicator bg-secondary d-flex align-items-center justify-content-center" style="width: 40px; height: 40px; border-radius: 50%;">
                                            <i class="fas fa-file-import text-white"></i>
                                        </div>
                                    </div>
                                    <div class="timeline-item-content p-3 bg-light rounded">
                                        <p class="fw-bold mb-1">Product Imported</p>
                                        <p class="mb-0 text-muted">Product imported from WooCommerce</p>
                                        <p class="text-xs text-muted">3 days ago</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modals -->
<!-- Generate AI Content Modal -->
<div class="modal fade" id="generateAIModal" tabindex="-1" aria-labelledby="generateAIModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="generateAIModalLabel">Generate AI Content</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Generate AI content for: <strong>{{ product.name }}</strong></p>
                <form id="generateAIForm" action="{{ path('app_admin_product_generate_ai', {'id': product.id}) }}" method="POST">
                    <input type="hidden" name="_csrf_token" value="{{ csrf_token('generate_ai') }}">
                    <div class="mb-3">
                        <label for="aiGenerationType" class="form-label">Generation Type</label>
                        <select class="form-select" id="aiGenerationType">
                            <option value="standard">Standard Generation</option>
                            <option value="premium">Premium Generation</option>
                        </select>
                        <small class="form-text text-muted">
                            Premium generation uses GPT-4 and includes additional content types.
                        </small>
                    </div>
                    <div class="mb-3">
                        <label for="aiGenerationOptions" class="form-label">Options</label>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="generateDescription" checked>
                            <label class="form-check-label" for="generateDescription">
                                Product Description
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="generateShortDescription" checked>
                            <label class="form-check-label" for="generateShortDescription">
                                Short Description
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="generateMetaDescription" checked>
                            <label class="form-check-label" for="generateMetaDescription">
                                Meta Description
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="generateImageAltText" checked>
                            <label class="form-check-label" for="generateImageAltText">
                                Image Alt Text
                            </label>
                        </div>
                        <div class="premium-options">
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="generateSeoKeywords">
                                <label class="form-check-label" for="generateSeoKeywords">
                                    SEO Keywords (Premium)
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="generateSocialMediaPost">
                                <label class="form-check-label" for="generateSocialMediaPost">
                                    Social Media Post (Premium)
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="alert alert-warning">
                        <div class="d-flex">
                            <div class="flex-shrink-0">
                                <i class="fas fa-coins text-warning"></i>
                            </div>
                            <div class="flex-grow-1 ms-2">
                                <div class="fw-bold">Credit Usage</div>
                                <p class="mb-0 small">
                                    Standard generation uses 1 credit.<br>
                                    Premium generation uses 2 credits.
                                </p>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="generateAIBtn" onclick="document.getElementById('generateAIForm').submit()">Generate Content</button>
            </div>
        </div>
    </div>
</div>

<!-- Export Product Modal -->
<div class="modal fade" id="exportProductModal" tabindex="-1" aria-labelledby="exportProductModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exportProductModalLabel">Export to WooCommerce</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Export product to WooCommerce: <strong>{{ product.name }}</strong></p>
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <span>This will overwrite the product content in WooCommerce.</span>
                </div>
                <form id="exportProductForm" action="{{ path('app_admin_product_export', {'id': product.id}) }}" method="POST">
                    <input type="hidden" name="_csrf_token" value="{{ csrf_token('export_product') }}">
                    <div class="mb-3">
                        <label for="exportOptions" class="form-label">Export Options</label>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="exportDescription" checked>
                            <label class="form-check-label" for="exportDescription">
                                Product Description
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="exportShortDescription" checked>
                            <label class="form-check-label" for="exportShortDescription">
                                Short Description
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="exportMetaDescription" checked>
                            <label class="form-check-label" for="exportMetaDescription">
                                Meta Description
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" id="exportImageAltText" checked>
                            <label class="form-check-label" for="exportImageAltText">
                                Image Alt Text
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success" id="exportProductBtn" onclick="document.getElementById('exportProductForm').submit()">Export to WooCommerce</button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Product Modal -->
<div class="modal fade" id="deleteProductModal" tabindex="-1" aria-labelledby="deleteProductModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteProductModalLabel">Confirm Deletion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete the product <strong>{{ product.name }}</strong>?</p>
                <p class="text-danger">This action cannot be undone. The product will be permanently deleted from the system.</p>
                <form id="deleteProductForm" action="{{ path('app_admin_product_delete', {'id': product.id}) }}" method="POST">
                    <input type="hidden" name="_csrf_token" value="{{ csrf_token('delete_product') }}">
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="confirmDelete" required>
                        <label class="form-check-label" for="confirmDelete">
                            I understand this action is permanent and cannot be undone
                        </label>
                    </div>
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="deleteFromWooCommerce">
                        <label class="form-check-label" for="deleteFromWooCommerce">
                            Also delete this product from WooCommerce
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="deleteProductBtn" disabled onclick="document.getElementById('deleteProductForm').submit()">Delete Product</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
    
    // Handle confirm delete checkbox
    const confirmDeleteCheckbox = document.getElementById('confirmDelete');
    const deleteProductBtn = document.getElementById('deleteProductBtn');
    
    if (confirmDeleteCheckbox && deleteProductBtn) {
        confirmDeleteCheckbox.addEventListener('change', function() {
            deleteProductBtn.disabled = !this.checked;
        });
    }
    
    // Handle tab activation from fragment identifier
    const hash = window.location.hash;
    if (hash) {
        const triggerEl = document.querySelector('button[data-bs-target="' + hash + '"]');
        if (triggerEl) {
            new bootstrap.Tab(triggerEl).show();
        }
    }
    
    // Handle AI generation type changes
    const aiGenerationType = document.getElementById('aiGenerationType');
    const premiumOptions = document.querySelectorAll('.premium-options .form-check-input');
    
    if (aiGenerationType && premiumOptions.length > 0) {
        aiGenerationType.addEventListener('change', function() {
            const isPremium = this.value === 'premium';
            premiumOptions.forEach(option => {
                option.disabled = !isPremium;
                if (!isPremium) {
                    option.checked = false;
                }
            });
        });
        
        // Initialize premium options state
        const isPremium = aiGenerationType.value === 'premium';
        premiumOptions.forEach(option => {
            option.disabled = !isPremium;
        });
    }
    
    // Content editing functionality
    const editContentBtns = document.querySelectorAll('.edit-content-btn');
    const cancelEditBtns = document.querySelectorAll('.cancel-edit-btn');
    const saveContentBtns = document.querySelectorAll('.save-content-btn');
    
    // Edit content buttons
    editContentBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const contentType = this.getAttribute('data-content-type');
            const previewEl = document.getElementById(contentType + 'Preview');
            const editorEl = document.getElementById(contentType + 'Editor');
            
            previewEl.classList.add('d-none');
            editorEl.classList.remove('d-none');
            
            // Update character count for meta fields
            if (contentType === 'metaDescription' || contentType === 'imageAltText') {
                const textarea = editorEl.querySelector('textarea');
                const countEl = editorEl.querySelector('.character-count');
                const maxLength = contentType === 'metaDescription' ? 155 : 125;
                
                updateCharacterCount(textarea, countEl, maxLength);
                
                textarea.addEventListener('input', function() {
                    updateCharacterCount(textarea, countEl, maxLength);
                });
            }
        });
    });
    
    // Cancel edit buttons
    cancelEditBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const contentType = this.getAttribute('data-content-type');
            const previewEl = document.getElementById(contentType + 'Preview');
            const editorEl = document.getElementById(contentType + 'Editor');
            
            previewEl.classList.remove('d-none');
            editorEl.classList.add('d-none');
        });
    });
    
    // Save content buttons (would need AJAX implementation in production)
    saveContentBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            const contentType = this.getAttribute('data-content-type');
            const previewEl = document.getElementById(contentType + 'Preview');
            const editorEl = document.getElementById(contentType + 'Editor');
            const textarea = editorEl.querySelector('textarea');
            
            // In a real implementation, you would save the content via AJAX here
            
            // For demo purposes, update the preview with the new content
            if (textarea.value.trim()) {
                previewEl.innerHTML = textarea.value.replace(/\n/g, '<br>');
            } else {
                previewEl.innerHTML = '<p class="text-muted">No content available.</p>';
            }
            
            previewEl.classList.remove('d-none');
            editorEl.classList.add('d-none');
            
            // Show success toast (would use a real toast component in production)
            alert('Content updated successfully');
        });
    });
    
    // Character count helper function
    function updateCharacterCount(textarea, countEl, maxLength) {
        const charCount = textarea.value.length;
        countEl.textContent = charCount + '/' + maxLength + ' characters';
        
        if (charCount > maxLength) {
            countEl.classList.add('text-danger');
            countEl.classList.remove('text-muted');
        } else {
            countEl.classList.remove('text-danger');
            countEl.classList.add('text-muted');
        }
    }
    
    // Restore original content buttons
    const restoreOriginalBtns = document.querySelectorAll('.restore-original-btn');
    
    restoreOriginalBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            if (confirm('Are you sure you want to restore the original content? This will overwrite any AI-generated content.')) {
                const contentType = this.getAttribute('data-content-type');
                // In a real implementation, you would restore via AJAX here
                alert('Original content restored');
            }
        });
    });
});
</script>
{% endblock %}